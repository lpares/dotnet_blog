@page
@using Blog.Data
@using Microsoft.AspNetCore.Identity
@using Blog.Models
@inject ApplicationDbContext DbContext
@inject SignInManager<User> SignInManager
@inject UserManager<User> UserManager

@{
    var articles = DbContext.Articles
        .OrderByDescending(c => c.UpdatedDate)
        .ToList();

    var isAdmin = false;
    if (SignInManager.IsSignedIn(User))
    {
        var currentUser = UserManager.GetUserAsync(User).Result;
        if (currentUser != null)
        {
            isAdmin = UserManager.IsInRoleAsync(currentUser, "Admin").Result;
        }
    }
}

<style>
    /* Ton CSS existant */
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f9f9f9;
    }
    /* ... (le reste de ton CSS) ... */
</style>

<div>
    <h1>Là où je parle et où je donne mon avis</h1>

    <div>
        @foreach (var article in articles)
        {
            var nbComments = DbContext.Comments
            .Count(comment => comment.IdArticle == article.Id);

            <div class="article">
                @if (isAdmin)
                {
                    <div class="article-actions">
                        <a asp-page="/Admin/EditArticle" asp-route-id="@article.Id" class="btn-edit">Editer</a>
                        <form asp-page="/Admin/DeleteArticle" asp-route-id="@article.Id" method="post" class="delete-form">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn-delete">Supprimer</button>
                        </form>
                    </div>
                }

                <div class="article-content">
                    </div>
                    <div class="article-text">
                        <div class="article-title">@article.Title</div>
                        <div class="article-preview">@article.Content</div>
                    </div>
                </div>

                <div class="article-footer">
                    <a asp-controller="Pages" asp-action="Article">Lire l'article</a>
                    <span class="comment-count">@nbComments commentaire(s)</span>
                </div>
        }
    </div>
</div>
